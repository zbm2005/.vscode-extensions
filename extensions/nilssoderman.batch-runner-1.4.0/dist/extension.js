"use strict";var y=Object.create;var u=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var N=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},w=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of $(t))!I.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(o=B(t,n))||o.enumerable});return e};var c=(e,t,r)=>(r=e!=null?y(k(e)):{},w(t||!e||!e.__esModule?u(r,"default",{value:e,enumerable:!0}):r,e)),D=e=>w(u({},"__esModule",{value:!0}),e);var K={};N(K,{activate:()=>H,deactivate:()=>W});module.exports=D(K);var a=c(require("vscode"));var m=c(require("vscode")),F=c(require("child_process")),p=c(require("path"));var i=c(require("vscode")),P=c(require("child_process")),l=c(require("path")),A="batch-runner",x="cmdPath";function h(e){let t;return e?t=i.workspace.getWorkspaceFolder(e)?.uri:i.window.activeTextEditor&&(t=i.workspace.getWorkspaceFolder(i.window.activeTextEditor.document.uri)?.uri),i.workspace.getConfiguration(A,t)}function C(){try{return P.execFileSync("net",["session"],{stdio:"ignore"}),!0}catch{return!1}}async function g(){let e=h().get(x,"C:\\windows\\System32\\cmd.exe"),t=i.Uri.file(e);if(!await R(t)){let r="Update path";i.window.showErrorMessage(`Cmd.exe could not be located at ${e}`,r).then(o=>{if(o===r){let n=`${A}.${x}`;i.commands.executeCommand("workbench.action.openSettings",n)}});return}return e}async function R(e){try{return await i.workspace.fs.stat(e),!0}catch{return!1}}function b(e,t){return l.normalize(e.fsPath).toLowerCase()===l.normalize(t.fsPath).toLowerCase()}var E="Batch Runner Terminal";async function _(e=!0,t=!0){let r=async()=>{let o=await g();if(o)return m.window.createTerminal(E,o)};for(let o of m.window.terminals)if(o.name===E)return t?(o.dispose(),r()):o;if(e)return r()}async function M(e,t=[]){let r=await _();if(!r)return!1;let o=e.fsPath,d=`cls & cd /d "${p.dirname(o)}" & "${o}" ${t.join(" ")}`;return r.sendText(d,!0),r.show(),!0}async function L(e,t=[],r=!1){let o=await g();if(!o)return!1;let n=e.fsPath,d=p.dirname(n),s=`start "${n}" /d "${d}" "${o}" /c ""${n}" ${t.join(" ")}"`;return r&&(s=`powershell Start-Process "${o}" -verb runAs -ArgumentList /c, title, """${n}""", """&""", cd, /d, """${d}""", """&""", """${n}"""`,t.length>0&&(s+=`, """${t.join(" ")}"""`)),F.exec(s),!0}async function f(e,t=[],r=!1){let o=h(e);if(o.get("saveFileBeforeRun")){let s=m.window.activeTextEditor?.document;if(s&&s.isDirty&&b(e,s.uri)&&!await s.save())return!1}let n=r&&!C(),d=o.get("runBatchIn");return n||d==="External-cmd"?L(e,t,r):M(e,t)}var U=c(require("vscode")),v={};async function T(e){let t=e?z(e):"",r=await U.window.showInputBox({placeHolder:"Arguments...",prompt:"Arguments to pass to the batch file",value:t});if(r!==void 0)return r?(e&&O(e,r),[r]):[]}function O(e,t){v[e.fsPath]={arg:t}}function z(e){return v[e.fsPath]?v[e.fsPath].arg:""}function H(e){e.subscriptions.push(a.commands.registerCommand("batch-runner.execBatchFile",t=>{let r=t||a.window.activeTextEditor?.document.uri;if(!r)throw new Error("No file path provided");return f(r,[],!1)})),e.subscriptions.push(a.commands.registerCommand("batch-runner.execBatchFileArgs",async t=>{let r=t||a.window.activeTextEditor?.document.uri;if(!r)throw new Error("No file path provided");let o=await T(r);return o!==void 0?f(r,o,!1):!1})),e.subscriptions.push(a.commands.registerCommand("batch-runner.execBatchFileAdmin",t=>{let r=t||a.window.activeTextEditor?.document.uri;if(!r)throw new Error("No file path provided");return f(r,[],!0)}))}function W(){}0&&(module.exports={activate,deactivate});
